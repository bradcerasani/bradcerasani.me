---
import { Caption, Figure } from 'src/components';
import Image from './RawImage.astro';

const {
  src,
  caption,
  size,
  alt,
  sizes: initialSizes = '',
  widths: initialWidths = [],
  loading = 'lazy',
} = Astro.props;

let sizes = initialSizes;
let widths = initialWidths;

// Only set default sizes and widths if they are not provided through props
if (!sizes || widths.length === 0) {
  switch (size) {
    case 'default':
      sizes = '(max-width: 639px) 100vw, (min-width: 640px) 640px';
      widths = [400, 640, 720, 800, 900, 1024, 1280];
      break;
    case 'large':
      sizes = '(max-width: 960px) 100vw, (max-width: 999px) 720px, (min-width: 1000px) 900px';
      widths = [400, 640, 720, 800, 900, 1024, 1280, 1800, 1920];
      break;
    case 'full':
      sizes = '(max-width: 2560px) 100vw, (min-width: 2561px) 2560px';
      widths = [320, 480, 640, 768, 1024, 1280, 1600, 1920, 2560, 3456, 3840, 5120];
      break;
  }
}
---

<Figure size={size}>
  <Image
    src={src}
    alt={alt || caption}
    sizes={sizes}
    widths={widths}
    loading={loading}
    decoding={loading === 'lazy' ? 'async' : 'sync'}
    quality={size === 'full' ? 70 : 80}
  />
  {caption && <Caption>{caption}</Caption>}
</Figure>
